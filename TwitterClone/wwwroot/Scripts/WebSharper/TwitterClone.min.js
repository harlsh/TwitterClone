(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;b=a.WebSharper=a.WebSharper||{};c=b.AspNetCore=b.AspNetCore||{};d=c.Tests=c.Tests||{};e=d.WebSocketClient=d.WebSocketClient||{};f=d.Website=d.Website||{};g=f.SomeRecord=f.SomeRecord||{};h=f.Client=f.Client||{};i=a.TwitterClone_Templates=a.TwitterClone_Templates||{};j=a.TwitterClone_JsonEncoder=a.TwitterClone_JsonEncoder||{};k=a.TwitterClone_JsonDecoder=a.TwitterClone_JsonDecoder||{};l=b&&b.UI;m=l&&l.Doc;n=l&&l.AttrProxy;o=l&&l.AttrModule;p=b&&b.Arrays;q=b&&b.Concurrency;r=b&&b.Unchecked;s=b&&b.JavaScript;t=s&&s.Promise;u=c&&c.WebSocket;v=u&&u.Client;w=v&&v.WithEncoding;x=a.JSON;y=b&&b.Utils;z=l&&l.Var$1;A=a.IntelliFactory;B=A&&A.Runtime;C=l&&l.Templating;D=C&&C.Runtime;E=D&&D.Server;F=E&&E.ProviderBuilder;G=E&&E.Handler;H=E&&E.TemplateInstance;I=l&&l.Client;J=I&&I.Templates;K=b&&b.ClientSideJson;L=K&&K.Provider;e.WebSocketTest=function(M){var N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4;function _5(_9){return _9(function(_){var $;$=self.document.createTextNode(_+"\n");O.elt.appendChild($);});}function _6(_9){N.$0.Post({$:5,$0:_9});}function _7(_9,_,$){var ba,bb,bc,bd,be,bf;ba=m.Element("button",[n.Create("class","retweet-handler btn btn-info"),o.Handler("click",function(){return function(){return _6(_);};})],[m.TextNode("Retweet!")]);bb=self.document.createElement("div");bc=self.document.createElement("div");bd=self.document.createElement("div").appendChild(ba.elt);bc.innerHTML=(be=[_,$,_9],"<div style=\"display:flex;justify-content:center\"><h4>"+(p.get(be,0)==null?"":a.String(p.get(be,0)))+("</h4><h4 style=\"margin-left:10px\">"+(p.get(be,1)==null?"":a.String(p.get(be,1))))+("</h4><h4 style=\"margin-left:10px\">"+(p.get(be,2)==null?"":a.String(p.get(be,2))))+"</h4><div>");bf=bb.appendChild(bc);bf.appendChild(bd);Q.elt.appendChild(bf);}function _8(_9,_,$){var ba;return q.Start((ba=null,q.Delay(function(){return q.Combine(r.Equals(N,null)?(a.alert("Retrying connection with the server. Please try again."),t.OfAsync(R).then(function(bb){N={$:1,$0:bb};}),q.Zero()):q.Zero(),q.Delay(function(){return q.Combine(_9==="Register"?T.Get().length<6?(a.alert("UserName must be atleast 6 characters."),q.Zero()):(N.$0.Post({$:0,$0:T.Get()}),q.Zero()):_9==="Subscribe"?U.Get().length<6?(a.alert("UserName must be atleast 6 characters."),q.Zero()):(N.$0.Post({$:6,$0:U.Get()}),q.Zero()):_9==="Login"?(N.$0.Post({$:1,$0:1}),q.Zero()):_9==="Logout"?(N.$0.Post({$:2,$0:1}),q.Zero()):_9==="Unsubscribe"?V.Get().length<6?(a.alert("UserName must be atleast 6 characters."),q.Zero()):(N.$0.Post({$:7,$0:V.Get()}),q.Zero()):_9==="Tweet"?W.Get().length<10?(a.alert("Tweet must be atleast 10 characters."),q.Zero()):(N.$0.Post({$:5,$0:W.Get()}),q.Zero()):_9==="HashTag"?X.Get().length<1?(a.alert("Please enter atleast 1 characters."),q.Zero()):(N.$0.Post({$:3,$0:"#"+X.Get()}),q.Zero()):_9==="Mention"?Y.Get().length<1?(a.alert("Please enter atleast 1 characters."),q.Zero()):(N.$0.Post({$:4,$0:"@"+Y.Get()}),q.Zero()):q.Zero(),q.Delay(function(){return q.Zero();}));}));})),null);}N=null;O=m.Element("pre",[],[]);P=m.Element("div",[],[m.Element("h3",[],[m.TextNode("Messages from server")])]);Q=m.Element("div",[],[]);R=(S=null,q.Delay(function(){return w.ConnectStateful(function(_9){return x.stringify((j.j())(_9));},function(_9){return(k.j())(x.parse(_9));},M,function(){var _9;_9=null;return q.Delay(function(){return q.Return([0,function(_){return function($){var ba;ba=null;return q.Delay(function(){var bb,bc,bd;return $.$==3?(_5(function(be){return be("WebSocket connection closed.");}),q.Return(_)):$.$==2?(_5(function(be){return be("WebSocket connection open.");}),q.Return(_)):$.$==1?(_5(function(be){return be("WebSocket connection error!");}),q.Return(_)):(bb=$.$0,q.Combine(bb.$==0?(bc=bb.$0,bc.indexOf("By")!=-1&&bc.indexOf("Time")!=-1&&bc.indexOf("Tweet")!=-1?(bd=bc.split(","),(_7(p.get(p.get(bd,0).split("\""),3),p.get(p.get(bd,1).split("\""),3),p.get(p.get(bd,2).split("\""),3)),q.Zero())):((_5(function(be){return function(bf){return be(y.toSafe(bf));};}))(bc),q.Zero())):q.Zero(),q.Delay(function(){return q.Return(_+1);})));});};}]);});});}));t.OfAsync(R).then(function(_9){N={$:1,$0:_9};});T=z.Create$1("");U=z.Create$1("");V=z.Create$1("");W=z.Create$1("");X=z.Create$1("");Y=z.Create$1("");Z=m.Element("div",[],[m.Input([n.Create("class","form-control")],T),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("Register"))],[m.TextNode("Register")])]);_0=m.Element("div",[],[m.Input([n.Create("class","form-control")],U),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("Subscribe"))],[m.TextNode("Subscribe")])]);_1=m.Element("div",[],[m.Input([n.Create("class","form-control")],V),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("Unsubscribe"))],[m.TextNode("Unsubscribe")])]);_2=m.Element("div",[],[m.Input([n.Create("class","form-control")],W),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("Tweet"))],[m.TextNode("Tweet")])]);_3=m.Element("div",[],[m.Input([n.Create("class","form-control")],X),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("HashTag"))],[m.TextNode("HashTag search")])]);_4=m.Element("div",[],[m.Input([n.Create("class","form-control")],Y),m.Element("button",[n.Create("class","btn btn-primary"),o.Handler("click",(B.Curried3(_8))("Mention"))],[m.TextNode("Mention search")])]);return m.Element("div",[],[m.Element("div",[n.Create("class","user-login-logout")],[m.Element("button",[n.Create("class","btn btn-success"),o.Handler("click",(B.Curried3(_8))("Login"))],[m.TextNode("Login")]),m.Element("button",[n.Create("class","btn btn-danger"),o.Handler("click",(B.Curried3(_8))("Logout"))],[m.TextNode("Logout")])]),m.Element("div",[],[Z,_0,_1,_2,_3,_4,P,O,Q])]);};g.New=function(M){return{Name:M};};h.Main=function(M){var N,O,P,Q,R;return(N=(O=e.WebSocketTest(M),(P=new F.New$1(),(P.h.push({$:0,$0:"websockettest",$1:O}),P))),(Q=G.CompleteHoles(N.k,N.h,[]),(R=new H.New(Q[1],i.body(Q[0])),N.i=R,R))).get_Doc();};i.body=function(M){J.LoadLocalTemplates("main");return M?J.NamedTemplate("main",{$:1,$0:"body"},M):void 0;};j.j=function(){return j._v?j._v:j._v=(L.EncodeUnion(void 0,{unsub:7,subs:6,tweet:5,mention:4,hashTag:3,randomInt2:2,randomInt:1,reg:0},[["Register",[["$0","reg",L.Id(),0]]],["Login",[["$0","randomInt",L.Id(),0]]],["Logout",[["$0","randomInt2",L.Id(),0]]],["HashTag",[["$0","hashTag",L.Id(),0]]],["Mention",[["$0","mention",L.Id(),0]]],["Tweet",[["$0","tweet",L.Id(),0]]],["Subscribe",[["$0","subs",L.Id(),0]]],["Unsubscribe",[["$0","unsub",L.Id(),0]]]]))();};k.j=function(){return k._v?k._v:k._v=(L.DecodeUnion(void 0,"type",[["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]]]))();};}(self));
